# H264ToMP4 海雀监控视频转码工具

## 项目简介

H264ToMP4 是一个专门用于将海雀监控摄像头录制的.v264格式视频文件转换为标准MP4格式的工具。转换后的MP4文件可以在各种主流播放器和设备上播放，支持进度条拖动。

## 功能特点

- **批量转码**：支持一次性处理整个目录中的所有.v264文件
- **多线程处理**：利用多核CPU加速转码过程
- **视频合并**：可将多个视频片段合并为一个完整的视频文件
- **音频处理**：可选择是否保留并转码音频流
- **进度监控**：实时显示转码进度和状态
- **任务控制**：支持暂停、继续、取消和重试失败任务
- **配置保存**：自动保存用户偏好设置
- **日志记录**：详细的操作日志，便于问题排查

## 系统要求

- 操作系统：Windows 7/8/10/11 (64位)
- 内存：4GB以上推荐
- 硬盘：至少有源文件大小2倍的可用空间
- CPU：多核CPU推荐，以提高转码速度

## 安装说明

### 方式一：使用预编译版本（推荐）

1. 从GitHub Releases页面下载最新版本的H264ToMP4.zip
2. 解压到任意目录（建议使用英文路径）
3. 双击运行H264ToMP4.exe即可使用

### 方式二：从源码运行（开发者）

1. 确保已安装Python 3.7或更高版本
2. 克隆或下载本仓库代码
3. 安装依赖项：
   ```
   pip install -r requirements.txt
   ```
4. 运行主程序：
   ```
   python main.py
   ```

## 使用指南

### 基本使用步骤

1. **选择源目录**：点击"浏览"按钮选择包含.v264文件的目录
2. **选择输出目录**：点击"浏览"按钮选择转换后MP4文件的保存位置
3. **扫描文件**：点击"扫描目录"按钮，程序会自动列出所有可转换的视频文件
4. **配置选项**：
   - 勾选"合并为一个视频"可将所有片段合并为一个文件
   - 勾选"包含音频处理"可处理视频中的音频（如果存在）
5. **开始转码**：点击"开始转码"按钮开始处理
6. **监控进度**：在界面中查看转码进度和状态
7. **完成处理**：转码完成后，可在输出目录中找到转换后的MP4文件

### 高级功能

#### 暂停和继续转码

- 转码过程中，可点击"暂停"按钮临时停止处理
- 点击"继续"按钮可从暂停处恢复转码

#### 取消转码

- 点击"取消"按钮可停止所有正在进行的转码任务
- 已完成的文件不会被删除

#### 重试失败任务

- 如果某些文件转码失败，可点击"重试失败任务"按钮重新处理这些文件

## 配置说明

程序会自动创建一个config.json配置文件，保存用户偏好设置。主要配置项包括：

- `source_dir`：源文件目录
- `output_dir`：输出文件目录
- `ffmpeg_path`：FFmpeg可执行文件路径
- `video_codec`：视频编码器（默认libx264）
- `crf`：视频质量参数（默认18，数值越小质量越高）
- `audio_codec`：音频编码器（默认aac）
- `audio_bitrate`：音频比特率（默认128k）
- `threads`：转码线程数（默认4）
- `overwrite`：是否覆盖已存在的文件（默认false）
- `keep_original`：是否保留原始文件（默认true）
- `log_level`：日志级别（默认INFO）

## 常见问题

### Q: 转码后的视频无法播放？
A: 请确保使用的是最新版本的播放器，如VLC、PotPlayer等。如果仍然无法播放，请检查日志文件查看可能的错误信息。

### Q: 转码速度很慢怎么办？
A: 可以尝试增加配置文件中的threads数值，但不要超过CPU核心数。同时确保硬盘有足够的读写速度。

### Q: 如何合并多个视频片段？
A: 在界面上勾选"合并为一个视频"选项，程序会按文件名中的时间戳顺序合并所有视频片段。

### Q: 转码后视频质量如何调整？
A: 可以修改配置文件中的crf值，范围通常为18-28，数值越小质量越高但文件越大。

### Q: 程序无法启动怎么办？
A: 请确保系统满足最低要求，并检查是否有防病毒软件阻止程序运行。如果问题持续，请查看日志文件获取详细错误信息。

## 技术支持

如果遇到问题或有功能建议，请通过以下方式联系：

1. 在GitHub上提交Issue
2. 发送邮件至项目维护者
3. 查看项目Wiki获取更多信息

## 版权信息

本项目采用MIT许可证，详见LICENSE文件。

## 致谢

感谢FFmpeg项目提供的强大视频处理能力，以及所有为本项目做出贡献的开发者。